name: "aws-cognito"
# Canonical GitHub repo
github_repo: "cloudposse-terraform-components/aws-cognito"
# Short description of this project
description: |-
  This component is responsible for provisioning and managing AWS Cognito resources.

  This component can provision the following resources:

  - [Cognito User Pools](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools.html)
  - [Cognito User Pool Clients](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html)
  - [Cognito User Pool Domains](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-add-custom-domain.html)
  - [Cognito User Pool Identity Providers](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-identity-provider.html)
  - [Cognito User Pool Resource Servers](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-define-resource-servers.html)
  - [Cognito User Pool User Groups](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-user-groups.html)
  - [Cognito Risk Configuration](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-risk-configuration.html)
usage: |-
  **Stack Level**: Global

  Here's an example snippet for how to use this component:

  ```yaml
  components:
    terraform:
      cognito:
        settings:
          spacelift:
            workspace_enabled: true
        vars:
          enabled: true
          # The full name of the User Pool will be: <namespace>-<environment>-<stage>-<name>
          name: cognito
          schemas:
            - name: "email"
              attribute_data_type: "String"
              developer_only_attribute: false
              mutable: false
              required: true
  ```

  ### Risk Configuration Examples

  #### Basic Account Takeover Protection

  ```yaml
  components:
    terraform:
      cognito:
        vars:
          enabled: true
          name: cognito
          # Configure account takeover risk protection
          account_takeover_risk_configuration:
            notify_configuration:
              block_email:
                html_body: "Your account has been blocked due to suspicious activity."
                subject: "Account Security Alert"
                text_body: "Your account has been blocked due to suspicious activity."
              from: "security@[company].com"
              source_arn: "arn:aws:ses:us-east-1:[account-id]:identity/security@[company].com"
            actions:
              high_action:
                event_action: "BLOCK"
                notify: true
              medium_action:
                event_action: "MFA_REQUIRED"
                notify: true
              low_action:
                event_action: "NO_ACTION"
                notify: false
  ```

  #### Compromised Credentials Detection

  ```yaml
  components:
    terraform:
      cognito:
        vars:
          enabled: true
          name: cognito
          # Configure compromised credentials detection
          compromised_credentials_risk_configuration:
            event_filter: ["SIGN_IN", "PASSWORD_CHANGE"]
            actions:
              event_action: "BLOCK"
  ```

  #### IP-Based Risk Exceptions

  ```yaml
  components:
    terraform:
      cognito:
        vars:
          enabled: true
          name: cognito
          # Configure IP-based risk exceptions
          risk_exception_configuration:
            blocked_ip_range_list:
              - "192.0.2.0/24"    # Block this IP range
              - "203.0.113.0/24"  # Block this IP range
            skipped_ip_range_list:
              - "10.0.0.0/8"      # Skip risk detection for internal network
              - "172.16.0.0/12"   # Skip risk detection for private network
  ```

  #### Client-Specific Risk Configuration

  ```yaml
  components:
    terraform:
      cognito:
        vars:
          enabled: true
          name: cognito
          clients:
            - name: "web-app"
              generate_secret: false
            - name: "mobile-app"
              generate_secret: true
          # Configure risk settings for specific clients
          # Note: client_id must be the actual App Client ID, not the client name
          risk_configurations:
            - client_id: "1a2b3c4d5e6f7g8h9i0j1k2l3m"  # Actual App Client ID for web-app
              account_takeover_risk_configuration:
                actions:
                  high_action:
                    event_action: "BLOCK"
                    notify: false
                  medium_action:
                    event_action: "MFA_IF_CONFIGURED"
                    notify: false
                  low_action:
                    event_action: "NO_ACTION"
                    notify: false
            - client_id: "9z8y7x6w5v4u3t2s1r0q9p8o7n"  # Actual App Client ID for mobile-app
              compromised_credentials_risk_configuration:
                event_filter: ["SIGN_IN"]
                actions:
                  event_action: "BLOCK"
  ```

  **Important:** The `client_id` field requires the actual AWS Cognito App Client ID, not the client name. To reference the App Client ID from the module outputs, use `module.cognito.client_ids_map["client-name"]` where `client-name` is the name you defined in the `clients` configuration.

  #### Comprehensive Risk Configuration

  ```yaml
  components:
    terraform:
      cognito:
        vars:
          enabled: true
          name: cognito
          # Comprehensive risk configuration with all features
          risk_configurations:
            - # Global User Pool configuration
              account_takeover_risk_configuration:
                notify_configuration:
                  block_email:
                    html_body: "<h1>Security Alert</h1><p>Your account has been temporarily blocked due to suspicious activity.</p>"
                    subject: "Account Security Alert - Action Required"
                    text_body: "Your account has been temporarily blocked due to suspicious activity. Please contact support."
                  mfa_email:
                    html_body: "<h1>Additional Verification Required</h1><p>We detected unusual activity and require additional verification.</p>"
                    subject: "Additional Verification Required"
                    text_body: "We detected unusual activity and require additional verification."
                  no_action_email:
                    html_body: "<h1>Security Notice</h1><p>We detected some unusual activity but no action is required.</p>"
                    subject: "Security Notice"
                    text_body: "We detected some unusual activity but no action is required."
                  from: "security@[company].com"
                  reply_to: "noreply@[company].com"
                  source_arn: "arn:aws:ses:us-east-1:[account-id]:identity/security@[company].com"
                actions:
                  high_action:
                    event_action: "BLOCK"
                    notify: true
                  medium_action:
                    event_action: "MFA_REQUIRED"
                    notify: true
                  low_action:
                    event_action: "NO_ACTION"
                    notify: true
              compromised_credentials_risk_configuration:
                event_filter: ["SIGN_IN", "PASSWORD_CHANGE", "SIGN_UP"]
                actions:
                  event_action: "BLOCK"
              risk_exception_configuration:
                blocked_ip_range_list:
                  - "192.0.2.0/24"
                  - "203.0.113.0/24"
                skipped_ip_range_list:
                  - "10.0.0.0/8"
                  - "172.16.0.0/12"
                  - "192.168.0.0/16"
  ```

  #### Using Module Outputs for Client IDs

  When you need to reference App Client IDs from the same module (e.g., in a separate resource or data source), use the `client_ids_map` output:

  ```yaml
  # Example: Using the cognito module's client_ids_map output in another resource
  components:
    terraform:
      cognito:
        vars:
          enabled: true
          name: cognito
          clients:
            - name: "web-app"
              generate_secret: false
            - name: "mobile-app"
              generate_secret: true

      # Separate resource that needs the client IDs
      cognito-risk-config:
        vars:
          user_pool_id: "${module.cognito.id}"
          web_app_client_id: "${module.cognito.client_ids_map['web-app']}"
          mobile_app_client_id: "${module.cognito.client_ids_map['mobile-app']}"
  ```

  <!-- prettier-ignore-start -->
  <!-- prettier-ignore-end -->
references:
  - name: "cloudposse-terraform-components"
    url: "https://github.com/orgs/cloudposse-terraform-components/repositories"
    description: "Cloud Posse's upstream component"
tags:
  - component/cognito
  - layer/addons
  - provider/aws
# Categories of this project
categories:
  - component/cognito
  - layer/addons
  - provider/aws
# License of this project
license: "APACHE2"
# Badges to display
badges:
  - name: Latest Release
    image: https://img.shields.io/github/release/cloudposse-terraform-components/aws-cognito.svg?style=for-the-badge
    url: https://github.com/cloudposse-terraform-components/aws-cognito/releases/latest
  - name: Slack Community
    image: https://slack.cloudposse.com/for-the-badge.svg
    url: https://slack.cloudposse.com
related:
  - name: "Cloud Posse Terraform Modules"
    description: Our collection of reusable Terraform modules used by our reference architectures.
    url: "https://docs.cloudposse.com/modules/"
  - name: "Atmos"
    description: "Atmos is like docker-compose but for your infrastructure"
    url: "https://atmos.tools"
contributors: [] # If included generates contribs
